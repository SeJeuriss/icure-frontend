<link rel="import" href="../../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../../bower_components/paper-item/paper-item.html">

<link rel="import" href="../../../../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">

<link rel="import" href="../../../styles/dialog-style.html">
<link rel="import" href="../../../styles/scrollbar-style.html">


<dom-module id="ht-pat-vaccine-product-dialog">
    <template>
        <style include="scrollbar-style dialog-style">
            #vaccineProductDialog {
                height: 480px;
                width: 640px;
                max-height: 480px;
                min-height: 480px;
                min-width: 640px;
            }
            .content {
                display:flex;
                flex-direction: column;
            }

            #products {
                flex-grow: 1;
            }

            vaadin-grid.material {

                font-family: Roboto, sans-serif;
                --divider-color: rgba(0, 0, 0, var(--dark-divider-opacity));

                --vaadin-grid-cell: {
                    padding: 8px;
                };

                --vaadin-grid-header-cell: {
                    height: 64px;
                    color: rgba(0, 0, 0, var(--dark-secondary-opacity));
                    font-size: var(--font-size-large);
                };

                --vaadin-grid-body-cell: {
                    height: 48px;
                    color: rgba(0, 0, 0, var(--dark-primary-opacity));
                    font-size: var(--font-size-normal);
                };

                --vaadin-grid-body-row-hover-cell: {
                    background-color: var(--paper-grey-200);
                };

                --vaadin-grid-body-row-selected-cell: {
                    background-color: var(--paper-grey-100);
                };

                --vaadin-grid-focused-cell: {
                    box-shadow: none;
                    font-weight: bold;
                };
            }

        </style>

        <paper-dialog id="vaccineProductDialog">
            <h2 class="modal-title">SÃ©lection d'un produit</h2>
            <div class="content">
                <paper-input id="name" label="[[localize('nam','Name',language)]]" always-float-label value="{{name}}"></paper-input>
                <vaadin-grid id="products" class="material" items="[[products]]" active-item="{{product}}">
                    <vaadin-grid-column width="100px">
                        <template class="header">
                            <vaadin-grid-sorter path="code">[[localize('cod','Code',language)]]
                            </vaadin-grid-sorter>
                        </template>
                        <template>
                            <div class="cell frozen">[[item.code]]</div>
                        </template>
                    </vaadin-grid-column>
                    <vaadin-grid-column width="200px">
                        <template class="header">
                            <vaadin-grid-sorter path="name">[[localize('nam','Name',language)]]
                            </vaadin-grid-sorter>
                        </template>
                        <template>
                            <div class="cell frozen">[[item.name]]</div>
                        </template>
                    </vaadin-grid-column>
                </vaadin-grid>
            </div>
            <div class="buttons">
                <paper-button class="button" on-tap="" dialog-dismiss>[[localize('can', "Cancel", language)]]</paper-button>
                <paper-button class="button button--save" dialog-dismiss autofocus on-tap="_addProduct">[[localize('add','Add',language)]]</paper-button>
            </div>
        </paper-dialog>

    </template>
    <script>
        import _ from 'lodash/lodash';

        class HtPatVaccineProductDialog extends Polymer.TkLocalizerMixin(Polymer.mixinBehaviors([Polymer.IronResizableBehavior], Polymer.Element)) {
            static get is() {
                return 'ht-pat-vaccine-product-dialog';
            }

            static get properties() {
                return {
                    api: {
                        type: Object,
                        value: null
                    },
                    user: {
                        type: Object,
                        value: null
                    },
                    language: {
                        type: String
                    },
                    name: {
                        type: String,
                        value: ""
                    },
                    products: {
                        type: Array,
                        value: []
                    },
                    product: {
                        type: Object,
                        value: null
                    }
                };
            }

            static get observers() {
                return [
                    "_productChanged(product)",
                ];
            }

            ready() {
                super.ready();

                this.products = [
                    { code: "PRO1", name: "Produit1" },
                    { code: "PRO2", name: "Produit2" },
                    { code: "PRO3", name: "Produit3" },
                    { code: "PRO4", name: "Produit4" },
                    { code: "PRO5", name: "Produit5" }
                ]
            }

            openDialog(detail) {
                this.$['vaccineProductDialog'].open();
                this._detail = detail;
                if (detail.period.product)
                    this.set("name", detail.period.product.name);
            }

            _addProduct() {
                console.log("Add Product")
                const product = this.products.find(p => p.name === this.name);
                this._detail.period.product = {
                    name: this.name,
                    code: product ? product.code : null
                }
                this.dispatchEvent(new CustomEvent('product-selected', {
                    detail: this._detail,
                    bubbles: true
                }));
                this._close();
            }

            _productChanged() {
                if (this.product)
                    this.set("name", this.product.name);
            }

            _close() {
                this.$['vaccineProductDialog'].close()
            }
        }
        customElements.define(HtPatVaccineProductDialog.is, HtPatVaccineProductDialog);
    </script>
</dom-module>

